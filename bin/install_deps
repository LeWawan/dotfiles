#!/usr/bin/env zsh

BASE_DIR=$(pwd)

# default

if [[ $(uname) == Linux ]]
then
  sudo apt install curl wget python3 python3-pip ripgrep fd-find unzip -y

elif [[ $(uname) == Darwin ]]
then
  brew install curl wget python3 python3-pip ripgrep fd-find unzip -y

else
  echo "install_deps error: device uname not recognized"
fi

# nvim latest installation
cd

if [[ $(uname) == Linux ]]
then
  NVIM_SOURCE="nvim-linux64"
  echo 'NVIM_SOURCE set to linux'
elif [[ $(uname) == Darwin ]]
then
  NVIM_SOURCE="nvim-macos"
  echo 'NVIM_SOURCE set to debian'
else
  echo "install_deps error: device uname not recognized"
fi


if [ -z "$NVIM_SOURCE" ]; then
  echo "NVIM_SOURCE is unset"
else
  echo "in here"
  if [[ -f "~/$NVIM_SOURCE.tar.gz" ]]; then
    rm "~/$NVIM_SOURCE.tar.gz"
  fi
  wget "https://github.com/neovim/neovim/releases/download/stable/$NVIM_SOURCE.tar.gz"
  tar -xzf "$NVIM_SOURCE.tar.gz"
  rm "$NVIM_SOURCE.tar.gz"

  sudo rm /usr/local/bin/nvim
  cd /usr/local/bin
  sudo ln -sf "$HOME/$NVIM_SOURCE/bin/nvim" nvim
fi

cd $BASE_DIR
echo "[install] latest nvim installed"

# Packer nvim installation
if [[ -d ~/.local/share/nvim/site/pack/packer/start/packer.nvim ]];then
  rm -rf ~/.local/share/nvim/site/pack/packer/start/packer.nvim
fi
git clone --depth 1 https://github.com/wbthomason/packer.nvim\
 ~/.local/share/nvim/site/pack/packer/start/packer.nvim
echo "[install] packer vim installed"

# nvm (manual install)
export NVM_DIR="$HOME/.nvm" && (
  git clone https://github.com/nvm-sh/nvm.git "$NVM_DIR"
  cd "$NVM_DIR"
  git checkout `git describe --abbrev=0 --tags --match "v[0-9]*" $(git rev-list --tags --max-count=1)`
) && \. "$NVM_DIR/nvm.sh"

# pnpm
npm install -g pnpm
echo "[install] pnpm installed"

# antfu ni
# https://github.com/antfu/ni
npm i -g @antfu/ni
echo "[install] antfu/ni"

# Rust
cd
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Go
cd
rm -rf /usr/local/go && tar -C /usr/local -xzf go1.20.linux-amd64.tar.gz

# Lua + luarocks
cd
curl -R -O http://www.lua.org/ftp/lua-5.4.4.tar.gz
tar zxf lua-5.4.4.tar.gz
cd lua-5.4.4
make all test
sudo make install


cd
curl -R -O https://luarocks.org/releases/luarocks-3.9.1.tar.gz
tar zxpf luarocks-3.9.1.tar.gz
cd luarocks-3.9.1
./configure && make && sudo make install
sudo luarocks install luasocket

cd $BASE_DIR
